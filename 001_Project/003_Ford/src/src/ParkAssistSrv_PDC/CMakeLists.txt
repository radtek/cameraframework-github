# generated by Voice CodeGen Version: R1_v1.3.0
# generated on: Fri Nov 25 12:19:27 IST 2016

cmake_minimum_required(VERSION 2.6)





set(OUTPUT_DIR ${CMAKE_SOURCE_DIR}/../)

if(DEFINED ENV{JAVA_HOME})                                      
   message("JAVA_HOME is $ENV{JAVA_HOME}")
else()              
   message(FATAL_ERROR" JAVA_HOME is not defined. $ENV{JAVA_HOME}. JAVA is needed for the DCIF code generator")
endif()

#Checking DCIF_CODE_GENERATOR path. If not defined,assigning with env path 
if(NOT DEFINED ${DCIF_CODE_GENERATOR})                                      
   message(WARNING "DCIF_CODE_GENERATOR is not defined. Hence considering $ENV{DCIF_CODE_GENERATOR}.")
   set(DCIF_CODE_GENERATOR $ENV{DCIF_CODE_GENERATOR})
endif()

if(EXISTS ${CMAKE_SOURCE_DIR}/gen)
add_subdirectory(gen EXCLUDE_FROM_ALL)
else()
message(WARNING "Couldn't find gen directory kindly run make generate and do the cmake again ")
endif()

add_subdirectory(src EXCLUDE_FROM_ALL)

if(EXISTS ${CMAKE_SOURCE_DIR}/src-gen)
add_subdirectory(src-gen EXCLUDE_FROM_ALL)
else()
message(WARNING "Couldn't find src-gen directory kindly run make generate and do the cmake again ")
endif()

set(GEN_COMMAND $ENV{JAVA_HOME} -jar ${DCIF_CODE_GENERATOR} -project=false -f=${CDL_DIR} -o=${OUTPUT_DIR} -c=ParkAssist)

set(MOVE_LIB_COMMAND mv src/ParkAssist . && mv gen/libParkAssist-* .)

set(CLEAN_GEN_COMMAND cmake -E remove_directory ${CMAKE_SOURCE_DIR}/gen)
set(CLEAN_SRC_GEN_COMMAND cmake -E remove_directory ${CMAKE_SOURCE_DIR}/src-gen)
set(COMPILE_MESSAGE "Kindly run "'cmake -DCDL_DIR=<CDL_PATH> -DCMAKE_SYSROOT=<SYS_ROOT_PATH>' 'make compile'"")

#Generate command
add_custom_target(
generate ${GEN_COMMAND}
WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
DEPENDS cleanall
)
#Compilation
add_custom_target(
compile 
COMMAND ${MOVE_LIB_COMMAND}
WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
DEPENDS ParkAssist ParkAssist-dbus
)

#Generate and compile
add_custom_target(
target  
COMMAND ${MOVE_LIB_COMMAND} 
WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
DEPENDS generate ParkAssist ParkAssist-dbus
)

#Delete src-gen and gen dirs
add_custom_target(
cleanall ${CLEAN_GEN_COMMAND} 
COMMAND ${CLEAN_SRC_GEN_COMMAND}
WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
)

add_custom_command(TARGET generate POST_BUILD
                   COMMAND ${CMAKE_COMMAND} -E cmake_echo_color --red
                   ${COMPILE_MESSAGE}
)

message (STATUS "generate-<PATH_TO_DCIF_CODE_GEN_JAR> <PATH_TO_CDL> <PATH_TO_SYS_ROOT>-Generates the code using DCIF command line generator.")
message (STATUS "compile-<PATH_TO_SYS_ROOT>-Compiles generated code and creates  .exe and required libs.")
message (STATUS "target-<PATH_TO_DCIF_CODE_GEN_JAR> <PATH_TO_CDL> <PATH_TO_SYS_ROOT>-Generates && compiles the code.")
message (STATUS "cleanall-Deletes generated directories (i.e gen & src-gen).")
message (STATUS "clean-Deletes compiled code i.e *.so and *.a files.")

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -std=c++11")

