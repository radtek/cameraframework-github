# generated by DCIF CodeGen Version: R2_v2.3.0
# generated on: Tue Aug 01 13:37:53 CST 2017


cmake_minimum_required(VERSION 2.6)

set(OUTPUT_DIR ${CMAKE_SOURCE_DIR})
set(RE_BUILD_COMMAND make rebuild_cache)
set(COMPILE_COMMAND make compile)
set(CLEAN_GEN_COMMAND cmake -E remove_directory ${CMAKE_SOURCE_DIR}/gen)
set(CLEAN_SRC_GEN_COMMAND cmake -E remove_directory ${CMAKE_SOURCE_DIR}/src-gen)

#Checking ELINA_LITE_DCIF_GENERATOR path. If not defined,assigning with env path 
if("${ELINA_LITE_DCIF_GENERATOR}" STREQUAL "")                                      
   message(WARNING "ELINA_LITE_DCIF_GENERATOR is not defined. Hence considering $ENV{ELINA_LITE_DCIF_GENERATOR}.")
   set(ELINA_LITE_DCIF_GENERATOR $ENV{ELINA_LITE_DCIF_GENERATOR})
endif()

if(EXISTS ${CMAKE_SOURCE_DIR}/gen)
add_subdirectory(gen)
endif()

if(EXISTS ${CMAKE_SOURCE_DIR}/src-gen)
add_subdirectory(src-gen)
endif()
add_subdirectory(src)

set(GEN_COMMAND ${ELINA_LITE_DCIF_GENERATOR} -application com.harman.dcif.codegen.cli.codeGenApplication -noSplash -src ${CDEPL_PATH} -dest ${OUTPUT_DIR} -comp adas)

#Generate command
add_custom_target(
generate ${GEN_COMMAND}
WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
DEPENDS cleanall
)
#Compilation
add_custom_target(
compile
WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
DEPENDS adas-dbus   adas
)

#Generate and compile
add_custom_target(
target
WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
DEPENDS generate
)

#Delete src-gen and gen dirs
add_custom_target(
cleanall ${CLEAN_GEN_COMMAND} 
COMMAND ${CLEAN_SRC_GEN_COMMAND}
WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
)

add_custom_command(TARGET target POST_BUILD
                   COMMAND ${RE_BUILD_COMMAND} COMMAND ${COMPILE_COMMAND})

add_custom_command(TARGET generate POST_BUILD COMMAND ${RE_BUILD_COMMAND})

message (STATUS "generate-<ELINA_LITE_DCIF_GENERATOR> <CDEPL_PATH>-Generates the code using ELINA_LITE_DCIF_GENERATOR.")
message (STATUS "compile-<CMAKE_SYSROOT>-Compiles generated code and creates  .exe and required libs.")
message (STATUS "target-<ELINA_LITE_DCIF_GENERATOR> <CDEPL_PATH> <CMAKE_SYSROOT>-Generates && compiles the code.")

message (STATUS "make-Compiles generated code.")
message (STATUS "install copies executables and libraries to build and <CMAKE_INSTALL_PREFIX> dir.")
message (STATUS "cleanall-Deletes generated directories (i.e gen & src-gen).")
message (STATUS "clean-Deletes compiled code i.e *.so and *.a files.")
#install(FILES ${CMAKE_BINARY_DIR}/src/adas ${CMAKE_BINARY_DIR}/gen/libadas-dbus.so   ${CMAKE_BINARY_DIR}/src-gen/libadas_adas_types_static_stub.a DESTINATION ${CMAKE_BINARY_DIR})
#install(FILES ${CMAKE_BINARY_DIR}/src/adas ${CMAKE_BINARY_DIR}/gen/libadas-dbus.so   ${CMAKE_BINARY_DIR}/src-gen/libadas_adas_types_static_stub.a DESTINATION ${CMAKE_INSTALL_PREFIX})

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -std=c++11")

